{"version":3,"sources":["../../src/components/defaults.ts"],"sourcesContent":["import { createError } from '../errors.js'\nimport { ArraySearchableType, Document, ElapsedTime, ScalarSearchableType, Schema, SearchableType } from '../types.js'\nimport { uniqueId, formatNanoseconds } from '../utils.js'\n\nexport { getDocumentProperties } from '../utils.js'\n\nexport async function formatElapsedTime(n: bigint): Promise<ElapsedTime> {\n  return {\n    raw: Number(n),\n    formatted: await formatNanoseconds(n),\n  }\n}\n\nexport async function getDocumentIndexId(doc: Document): Promise<string> {\n  if (doc.id) {\n    if (typeof doc.id !== 'string') {\n      throw createError('DOCUMENT_ID_MUST_BE_STRING', typeof doc.id)\n    }\n\n    return doc.id\n  }\n\n  return await uniqueId()\n}\n\nexport async function validateSchema<S extends Schema = Schema>(doc: Document, schema: S): Promise<string | undefined> {\n  for (const [prop, type] of Object.entries(schema)) {\n    const value = doc[prop]\n    const typeOfValue = typeof value\n\n    if (typeOfValue === 'undefined') {\n      continue\n    }\n\n    const typeOfType = typeof type\n\n    if (typeOfType === 'string' && isArrayType(type as SearchableType)) {\n      if (!Array.isArray(value)) {\n        return prop\n      }\n      const expectedType = getInnerType(type as ArraySearchableType)\n\n      const valueLength = value.length\n      for (let i = 0; i < valueLength; i++) {\n        if (typeof value[i] !== expectedType) {\n          return prop + '.' + i\n        }\n      }\n\n      continue\n    }\n\n    if (typeOfType === 'object') {\n      if (!value || typeOfValue !== 'object') {\n        return prop\n      }\n\n      const subProp = await validateSchema(value as Document, type as Schema)\n      if (subProp) {\n        return prop + '.' + subProp\n      }\n      continue\n    }\n\n    if (typeOfValue !== type) {\n      return prop\n    }\n  }\n\n  return undefined\n}\n\nconst IS_ARRAY_TYPE: Record<SearchableType, boolean> = {\n  string: false,\n  number: false,\n  boolean: false,\n  'string[]': true,\n  'number[]': true,\n  'boolean[]': true,\n}\nconst INNER_TYPE: Record<ArraySearchableType, ScalarSearchableType> = {\n  'string[]': 'string',\n  'number[]': 'number',\n  'boolean[]': 'boolean',\n}\nexport function isArrayType(type: SearchableType) {\n  return IS_ARRAY_TYPE[type]\n}\nexport function getInnerType(type: ArraySearchableType): ScalarSearchableType {\n  return INNER_TYPE[type]\n}\n"],"names":["createError","uniqueId","formatNanoseconds","getDocumentProperties","formatElapsedTime","n","raw","Number","formatted","getDocumentIndexId","doc","id","validateSchema","schema","prop","type","Object","entries","value","typeOfValue","typeOfType","isArrayType","Array","isArray","expectedType","getInnerType","valueLength","length","i","subProp","undefined","IS_ARRAY_TYPE","string","number","boolean","INNER_TYPE"],"mappings":"AAAA,SAASA,WAAW,QAAQ,eAAc;AAE1C,SAASC,QAAQ,EAAEC,iBAAiB,QAAQ,cAAa;AAEzD,SAASC,qBAAqB,QAAQ,cAAa;AAEnD,OAAO,eAAeC,kBAAkBC,CAAS,EAAwB;IACvE,OAAO;QACLC,KAAKC,OAAOF;QACZG,WAAW,MAAMN,kBAAkBG;IACrC;AACF,CAAC;AAED,OAAO,eAAeI,mBAAmBC,GAAa,EAAmB;IACvE,IAAIA,IAAIC,EAAE,EAAE;QACV,IAAI,OAAOD,IAAIC,EAAE,KAAK,UAAU;YAC9B,MAAMX,YAAY,8BAA8B,OAAOU,IAAIC,EAAE,EAAC;QAChE,CAAC;QAED,OAAOD,IAAIC,EAAE;IACf,CAAC;IAED,OAAO,MAAMV;AACf,CAAC;AAED,OAAO,eAAeW,eAA0CF,GAAa,EAAEG,MAAS,EAA+B;IACrH,KAAK,MAAM,CAACC,MAAMC,KAAK,IAAIC,OAAOC,OAAO,CAACJ,QAAS;QACjD,MAAMK,QAAQR,GAAG,CAACI,KAAK;QACvB,MAAMK,cAAc,OAAOD;QAE3B,IAAIC,gBAAgB,aAAa;YAC/B,QAAQ;QACV,CAAC;QAED,MAAMC,aAAa,OAAOL;QAE1B,IAAIK,eAAe,YAAYC,YAAYN,OAAyB;YAClE,IAAI,CAACO,MAAMC,OAAO,CAACL,QAAQ;gBACzB,OAAOJ;YACT,CAAC;YACD,MAAMU,eAAeC,aAAaV;YAElC,MAAMW,cAAcR,MAAMS,MAAM;YAChC,IAAK,IAAIC,IAAI,GAAGA,IAAIF,aAAaE,IAAK;gBACpC,IAAI,OAAOV,KAAK,CAACU,EAAE,KAAKJ,cAAc;oBACpC,OAAOV,OAAO,MAAMc;gBACtB,CAAC;YACH;YAEA,QAAQ;QACV,CAAC;QAED,IAAIR,eAAe,UAAU;YAC3B,IAAI,CAACF,SAASC,gBAAgB,UAAU;gBACtC,OAAOL;YACT,CAAC;YAED,MAAMe,UAAU,MAAMjB,eAAeM,OAAmBH;YACxD,IAAIc,SAAS;gBACX,OAAOf,OAAO,MAAMe;YACtB,CAAC;YACD,QAAQ;QACV,CAAC;QAED,IAAIV,gBAAgBJ,MAAM;YACxB,OAAOD;QACT,CAAC;IACH;IAEA,OAAOgB;AACT,CAAC;AAED,MAAMC,gBAAiD;IACrDC,QAAQ,KAAK;IACbC,QAAQ,KAAK;IACbC,SAAS,KAAK;IACd,YAAY,IAAI;IAChB,YAAY,IAAI;IAChB,aAAa,IAAI;AACnB;AACA,MAAMC,aAAgE;IACpE,YAAY;IACZ,YAAY;IACZ,aAAa;AACf;AACA,OAAO,SAASd,YAAYN,IAAoB,EAAE;IAChD,OAAOgB,aAAa,CAAChB,KAAK;AAC5B,CAAC;AACD,OAAO,SAASU,aAAaV,IAAyB,EAAwB;IAC5E,OAAOoB,UAAU,CAACpB,KAAK;AACzB,CAAC"}